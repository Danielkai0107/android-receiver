# SafeNet Android æŽ¥æ”¶å™¨ - å®Œæ•´æ›´æ–°èªªæ˜Ž

**æ›´æ–°æ—¥æœŸï¼š** 2026-01-20  
**ç‰ˆæœ¬ï¼š** v1.1

---

## ðŸ“‹ æ›´æ–°æ¦‚è¦

æœ¬æ¬¡æ›´æ–°åŒ…å«å…©å€‹ä¸»è¦éƒ¨åˆ†ï¼š

### ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¤ŽåŠŸèƒ½å„ªåŒ–ï¼ˆ4é …ï¼‰
1. âœ… é¦–é æ–°å¢žã€ŒçµæŸæ‡‰ç”¨ã€æŒ‰éˆ•
2. âœ… å•Ÿå‹•æ™‚è‡ªå‹•æª¢æŸ¥æ¬Šé™
3. âœ… é¦–é æŒ‰éˆ•æ¨£å¼çµ±ä¸€
4. âœ… å‰µå»ºä¸Šå‚³è¨˜éŒ„é é¢

### ç¬¬äºŒéƒ¨åˆ†ï¼šHTTP æ—¥èªŒåŠŸèƒ½ï¼ˆ1é …ï¼‰
5. âœ… ä¸Šå‚³è¨˜éŒ„é¡¯ç¤ºå®Œæ•´ HTTP è«‹æ±‚/éŸ¿æ‡‰

---

## ðŸŽ¯ ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¤ŽåŠŸèƒ½å„ªåŒ–

### 1. é¦–é æ–°å¢žã€ŒçµæŸæ‡‰ç”¨ã€æŒ‰éˆ•

**åŠŸèƒ½æè¿°ï¼š**
- åœ¨é¦–é åº•éƒ¨æ–°å¢žã€ŒçµæŸæ‡‰ç”¨ã€æŒ‰éˆ•
- é»žæ“Šæ™‚å½ˆå‡ºç¢ºèªå°è©±æ¡†
- ç¢ºèªå¾ŒåŸ·è¡Œï¼š
  1. åœæ­¢æŽƒææœå‹™
  2. æ¸…é™¤æ‰€æœ‰æš«å­˜è³‡æ–™
  3. å®Œå…¨é—œé–‰æ‡‰ç”¨ç¨‹å¼

**æŠ€è¡“å¯¦ä½œï¼š**
```kotlin
// HomeFragment.kt
private fun exitApplication() {
    // åœæ­¢æœå‹™
    if (isServiceRunning) {
        requireContext().stopService(Intent(requireContext(), BeaconScanService::class.java))
    }
    // æ¸…é™¤è³‡æ–™
    viewModel.clearAllData()
    // é—œé–‰æ‡‰ç”¨
    requireActivity().finishAffinity()
    Process.killProcess(Process.myPid())
}
```

### 2. å•Ÿå‹•æ™‚è‡ªå‹•æª¢æŸ¥æ¬Šé™

**åŠŸèƒ½æè¿°ï¼š**
- App å•Ÿå‹•æ™‚è‡ªå‹•æª¢æŸ¥æ‰€æœ‰å¿…è¦æ¬Šé™
- æœªæŽˆæ¬Šæ™‚è‡ªå‹•å½ˆå‡ºèªªæ˜Žå°è©±æ¡†
- æ”¯æ´çš„æ¬Šé™ï¼š
  - ä½ç½®æ¬Šé™ï¼ˆå‰å°å’ŒèƒŒæ™¯ï¼‰
  - è—ç‰™æ¬Šé™ï¼ˆAndroid 12+ï¼‰
  - æ‰‹æ©Ÿç‹€æ…‹æ¬Šé™ï¼ˆç²å– IMEIï¼‰
  - é€šçŸ¥æ¬Šé™ï¼ˆAndroid 13+ï¼‰

**æŠ€è¡“å¯¦ä½œï¼š**
```kotlin
// MainActivity.kt
private fun checkAndRequestPermissions() {
    val notGrantedPermissions = permissions.filter { permission ->
        ContextCompat.checkSelfPermission(this, permission) != PERMISSION_GRANTED
    }
    
    if (notGrantedPermissions.isNotEmpty()) {
        showPermissionRequestDialog(notGrantedPermissions)
    }
}
```

### 3. é¦–é æŒ‰éˆ•æ¨£å¼çµ±ä¸€

**è®Šæ›´å…§å®¹ï¼š**

| æŒ‰éˆ•åç¨± | èˆŠæ¨£å¼ | æ–°æ¨£å¼ | ç‰¹é»ž |
|---------|--------|--------|------|
| é–‹å§‹æŽƒæ | â–¶ï¸ é–‹å§‹æŽƒæ | é–‹å§‹æŽƒæ | è—è‰² filled |
| åœæ­¢æŽƒæ | â¹ åœæ­¢æŽƒæ | åœæ­¢æŽƒæ | ç´…è‰² filled |
| æŸ¥çœ‹æŽƒææ¸…å–® | ðŸ“‹ æŸ¥çœ‹æŽƒææ¸…å–® | æŸ¥çœ‹æŽƒææ¸…å–® | outline |
| ä¸Šå‚³è¨˜éŒ„ | (æ–°å¢ž) | ä¸Šå‚³è¨˜éŒ„ | outline |
| åŒæ­¥ UUID | ðŸ”„ åŒæ­¥æœå‹™ UUID | åŒæ­¥ UUID | outline |
| çµæŸæ‡‰ç”¨ | (æ–°å¢ž) | çµæŸæ‡‰ç”¨ | outline |

**çµ±ä¸€è¦æ ¼ï¼š**
- âŒ ç§»é™¤æ‰€æœ‰ emoji
- âœ… çµ±ä¸€é«˜åº¦ï¼š60dp
- âœ… çµ±ä¸€å­—é«”ï¼š16sp
- âœ… ä¸»è¦æ“ä½œï¼šfilled æ¨£å¼
- âœ… æ¬¡è¦æ“ä½œï¼šoutline æ¨£å¼

### 4. å‰µå»ºä¸Šå‚³è¨˜éŒ„é é¢

**åŠŸèƒ½ç‰¹é»žï¼š**
- âœ… é¡¯ç¤ºæ‰€æœ‰ä¸Šå‚³è¨˜éŒ„ï¼ˆ**ä¸åŽ»é‡**ï¼‰
- âœ… é¡¯ç¤ºç¸½ä¸Šå‚³æ•¸çµ±è¨ˆ
- âœ… å·¥å…·åˆ—åŒ…å«æ¸…ç©ºæŒ‰éˆ•
- âœ… æ¯ç­†è¨˜éŒ„é¡¯ç¤ºåŸºæœ¬è³‡è¨Š

**é¡¯ç¤ºå…§å®¹ï¼š**
- UUIDã€Majorã€Minor
- RSSIï¼ˆä¿¡è™Ÿå¼·åº¦ï¼‰
- ä½ç½®ï¼ˆç¶“ç·¯åº¦ï¼‰
- æŽƒææ™‚é–“
- ä¸Šå‚³ç‹€æ…‹

---

## ðŸ” ç¬¬äºŒéƒ¨åˆ†ï¼šHTTP æ—¥èªŒåŠŸèƒ½

### åŠŸèƒ½æè¿°

åœ¨ä¸Šå‚³è¨˜éŒ„é é¢é¡¯ç¤ºå®Œæ•´çš„ HTTP è«‹æ±‚å’ŒéŸ¿æ‡‰è³‡è¨Šï¼Œæ ¼å¼é¡žä¼¼ OkHttp çš„æ—¥èªŒè¼¸å‡ºã€‚

### é¡¯ç¤ºæ ¼å¼

```
--> POST https://us-central1-safe-net-tw.cloudfunctions.net/receiveBeaconData
Content-Type: application/json; charset=UTF-8
Content-Length: 193

{"beacons":[{"major":1,"minor":0,"rssi":-36,"uuid":"00000000-0000-0000-0000-000000000000"}],"gateway_id":"ANDROID-42ec6a54d319eb84","lat":24.9810858,"lng":121.5386161,"timestamp":1768923390218}
--> END POST

<-- 200 https://us-central1-safe-net-tw.cloudfunctions.net/receiveBeaconData (2479ms)
content-type: application/json; charset=utf-8
server: Google Frontend

{"success":true,"received":1,"updated":0,"ignored":1,"timestamp":1768923390218}
<-- END HTTP
```

### æŠ€è¡“æž¶æ§‹

#### 1. è³‡æ–™åº«å±¤

**BeaconQueueEntity.kt** - æ–°å¢žæ¬„ä½ï¼š
```kotlin
val uploadedAt: Long? = null          // ä¸Šå‚³æ™‚é–“æˆ³
val requestUrl: String? = null        // è«‹æ±‚ URL
val requestBody: String? = null       // è«‹æ±‚ Body (JSON)
val requestHeaders: String? = null    // è«‹æ±‚ Headers (JSON)
val responseCode: Int? = null         // éŸ¿æ‡‰ç‹€æ…‹ç¢¼
val responseBody: String? = null      // éŸ¿æ‡‰ Body (JSON)
val responseHeaders: String? = null   // éŸ¿æ‡‰ Headers (JSON)
val responseDuration: Long? = null    // éŸ¿æ‡‰æ™‚é–“ (ms)
```

**è³‡æ–™åº«ç‰ˆæœ¬ï¼š** 4 â†’ 5

#### 2. è³‡æ–™å±¤

**UploadDetails.kt** - æ–°å¢žè³‡æ–™é¡žï¼š
```kotlin
data class UploadDetails(
    val success: Boolean,
    val requestUrl: String,
    val requestBody: String,
    val requestHeaders: Map<String, String>,
    val responseCode: Int,
    val responseBody: String,
    val responseHeaders: Map<String, String>,
    val responseDuration: Long,
    val uploadedAt: Long = System.currentTimeMillis()
)
```

**UploadRepository.kt** - æ•ç² HTTP è³‡è¨Šï¼š
- è¨˜éŒ„è«‹æ±‚é–‹å§‹æ™‚é–“
- åºåˆ—åŒ–è«‹æ±‚ Body å’Œ Headers
- æŽ¥æ”¶éŸ¿æ‡‰å¾Œè¨˜éŒ„ç‹€æ…‹ç¢¼ã€Bodyã€Headers
- è¨ˆç®—éŸ¿æ‡‰æ™‚é–“ï¼ˆçµæŸæ™‚é–“ - é–‹å§‹æ™‚é–“ï¼‰
- è¿”å›žåŒ…å«æ‰€æœ‰è³‡è¨Šçš„ `UploadDetails` ç‰©ä»¶

**UploadWorker.kt** - ä¿å­˜ HTTP è³‡è¨Šï¼š
- æŽ¥æ”¶ `UploadDetails`
- ç‚ºæ¯å€‹ä¸Šå‚³çš„ Beacon èª¿ç”¨ `updateUploadDetails()`
- å°‡ JSON æ ¼å¼çš„è³‡æ–™å¯«å…¥è³‡æ–™åº«

#### 3. UI å±¤

**UploadHistoryAdapter.kt** - æ ¼å¼åŒ–é¡¯ç¤ºï¼š
```kotlin
private fun buildHttpLog(beacon: BeaconQueueEntity): String {
    // çµ„è£ OkHttp é¢¨æ ¼çš„æ—¥èªŒ
    // --> POST URL
    // Headers
    // Body
    // --> END POST
    // <-- CODE URL (duration)
    // Headers
    // Body
    // <-- END HTTP
}
```

**item_upload_history.xml** - UI ä½ˆå±€ï¼š
- ScrollViewï¼ˆæœ€å¤§é«˜åº¦ 300dpï¼‰
- TextViewï¼ˆmonospace å­—é«”ï¼Œ9spï¼‰
- ç°è‰²èƒŒæ™¯ï¼ˆ#F5F5F5ï¼‰

---

## ðŸ“ ä¿®æ”¹çš„æª”æ¡ˆç¸½è¦½

### æ–°å¢žæª”æ¡ˆï¼ˆ6å€‹ï¼‰
1. `UploadHistoryActivity.kt` - ä¸Šå‚³è¨˜éŒ„é é¢
2. `UploadHistoryViewModel.kt` - ViewModel
3. `UploadHistoryAdapter.kt` - RecyclerView Adapter
4. `UploadDetails.kt` - ä¸Šå‚³è©³æƒ…è³‡æ–™é¡ž
5. `activity_upload_history.xml` - é é¢ä½ˆå±€
6. `item_upload_history.xml` - é …ç›®ä½ˆå±€

### ä¿®æ”¹æª”æ¡ˆï¼ˆ11å€‹ï¼‰

#### Presentation Layer
1. `HomeFragment.kt` - æ–°å¢žçµæŸæ‡‰ç”¨å’Œä¸Šå‚³è¨˜éŒ„æŒ‰éˆ•é‚è¼¯
2. `MainActivity.kt` - æ–°å¢žæ¬Šé™æª¢æŸ¥åŠŸèƒ½
3. `fragment_home.xml` - æ›´æ–°æŒ‰éˆ•æ¨£å¼

#### Data Layer
4. `BeaconQueueEntity.kt` - æ–°å¢ž HTTP æ¬„ä½
5. `BeaconQueueDao.kt` - æ–°å¢žæŸ¥è©¢å’Œæ›´æ–°æ–¹æ³•
6. `BeaconRepository.kt` - æ–°å¢ž `updateUploadDetails()`
7. `UploadRepository.kt` - æ•ç²ä¸¦è¿”å›ž HTTP è©³æƒ…
8. `UploadWorker.kt` - ä¿å­˜ HTTP è©³æƒ…

#### Database
9. `AppDatabase.kt` - ç‰ˆæœ¬å‡ç´šåˆ° 5

#### Configuration
10. `AndroidManifest.xml` - è¨»å†Šæ–° Activity
11. `menu_upload_history.xml` - ä¸Šå‚³è¨˜éŒ„é¸å–®

---

## âœ… æ§‹å»ºèˆ‡æ¸¬è©¦

### æ§‹å»ºç‹€æ…‹
```
âœ… BUILD SUCCESSFUL
â±ï¸ æ§‹å»ºæ™‚é–“: ~10 ç§’
âš ï¸ è­¦å‘Š: 0
âŒ éŒ¯èª¤: 0
```

### æ¸¬è©¦æª¢æŸ¥æ¸…å–®

#### åŸºç¤ŽåŠŸèƒ½æ¸¬è©¦
- [ ] é¦–é æŒ‰éˆ•æ¨£å¼ä¸€è‡´æ€§
- [ ] é–‹å§‹æŽƒææŒ‰éˆ•ï¼ˆè—è‰²ï¼‰
- [ ] åœæ­¢æŽƒææŒ‰éˆ•ï¼ˆç´…è‰²ï¼‰
- [ ] çµæŸæ‡‰ç”¨åŠŸèƒ½
- [ ] æ¬Šé™è‡ªå‹•è«‹æ±‚
- [ ] æ¬Šé™æ‹’çµ•è™•ç†

#### ä¸Šå‚³è¨˜éŒ„æ¸¬è©¦
- [ ] è¨˜éŒ„ä¸åŽ»é‡é¡¯ç¤º
- [ ] æ¸…ç©ºè¨˜éŒ„åŠŸèƒ½
- [ ] HTTP æ—¥èªŒé¡¯ç¤º
- [ ] Request URL æ­£ç¢º
- [ ] Request Headers æ­£ç¢º
- [ ] Request Body æ ¼å¼æ­£ç¢º
- [ ] Response Code æ­£ç¢º
- [ ] Response Body æ­£ç¢º
- [ ] éŸ¿æ‡‰æ™‚é–“é¡¯ç¤º
- [ ] æ—¥èªŒæ»¾å‹•æŸ¥çœ‹

#### è³‡æ–™åº«æ¸¬è©¦
- [ ] å¸è¼‰é‡è£æ­£å¸¸
- [ ] è³‡æ–™åº«å‡ç´šæˆåŠŸ
- [ ] æ–°æ¬„ä½ä¿å­˜æ­£å¸¸

---

## ðŸŽ¨ UI æˆªåœ–èªªæ˜Ž

### é¦–é ï¼ˆæ›´æ–°å¾Œï¼‰
- çµ±ä¸€æ¨£å¼çš„ 6 å€‹æŒ‰éˆ•
- ç„¡ emojiï¼Œç´”æ–‡å­—
- æ¸…æ™°çš„è¦–è¦ºå±¤æ¬¡

### ä¸Šå‚³è¨˜éŒ„é é¢
- å¡ç‰‡å¼ä½ˆå±€
- å®Œæ•´çš„ HTTP æ—¥èªŒ
- å¯æ»¾å‹•æŸ¥çœ‹é•·æ—¥èªŒ

---

## ðŸ“Š æ•ˆèƒ½å½±éŸ¿

### è³‡æ–™åº«
- æ–°å¢ž 8 å€‹æ¬„ä½ï¼ˆå¯ç‚º nullï¼‰
- å°ç¾æœ‰æŸ¥è©¢ç„¡å½±éŸ¿
- è¨˜éŒ„å¤§å°å¢žåŠ ç´„ 1-2KB/ç­†

### ä¸Šå‚³æµç¨‹
- å¢žåŠ  JSON åºåˆ—åŒ–æ“ä½œ
- å¢žåŠ ç´„ 10-20ms è™•ç†æ™‚é–“
- å°æ•´é«”ä¸Šå‚³æ™‚é–“å½±éŸ¿å¯å¿½ç•¥

---

## ðŸ”§ å¾ŒçºŒå»ºè­°

### çŸ­æœŸå„ªåŒ–
1. æ–°å¢žç¯©é¸åŠŸèƒ½ï¼ˆæŒ‰æ™‚é–“ã€è¨­å‚™ã€ç‹€æ…‹ï¼‰
2. æ–°å¢žåŒ¯å‡ºåŠŸèƒ½ï¼ˆCSV/JSONï¼‰
3. æ–°å¢žæœå°‹åŠŸèƒ½

### ä¸­æœŸå„ªåŒ–
1. åœ–è¡¨çµ±è¨ˆï¼ˆä¸Šå‚³æˆåŠŸçŽ‡ã€å¹³å‡éŸ¿æ‡‰æ™‚é–“ï¼‰
2. éŒ¯èª¤æ—¥èªŒåˆ†æž
3. ç¶²è·¯è¨ºæ–·å·¥å…·

### é•·æœŸå„ªåŒ–
1. æ—¥èªŒè‡ªå‹•æ¸…ç†ç­–ç•¥
2. é›¢ç·šæ—¥èªŒå£“ç¸®
3. é ç«¯æ—¥èªŒä¸Šå‚³ï¼ˆé™¤éŒ¯ç”¨ï¼‰

---

## ðŸ“ž æŠ€è¡“æ”¯æ´

### å¸¸è¦‹å•é¡Œ

**Q: è³‡æ–™åº«å‡ç´šå¾ŒèˆŠè³‡æ–™æœƒä¸Ÿå¤±å—Žï¼Ÿ**  
A: æ˜¯çš„ï¼Œå› ç‚ºä½¿ç”¨ `fallbackToDestructiveMigration()`ï¼Œé¦–æ¬¡å®‰è£æ–°ç‰ˆæœ¬å¾Œæœƒé‡å»ºè³‡æ–™åº«ã€‚

**Q: HTTP æ—¥èªŒæœƒä½”ç”¨å¾ˆå¤šç©ºé–“å—Žï¼Ÿ**  
A: æ¯ç­†è¨˜éŒ„ç´„å¢žåŠ  1-2KBï¼Œå»ºè­°å®šæœŸæ¸…ç†èˆŠè¨˜éŒ„ã€‚

**Q: ç‚ºä»€éº¼ä¸Šå‚³è¨˜éŒ„ä¸åŽ»é‡ï¼Ÿ**  
A: é€™æ˜¯ç”¨æˆ¶éœ€æ±‚ï¼Œç‚ºäº†æŸ¥çœ‹æ¯æ¬¡å¯¦éš›çš„ä¸Šå‚³å‹•ä½œå’Œ HTTP äº¤äº’ã€‚

---

## ðŸ“ ç‰ˆæœ¬æ­·å²

- **v1.1** (2026-01-20) - HTTP æ—¥èªŒåŠŸèƒ½
- **v1.0** (2026-01-20) - åŸºç¤ŽåŠŸèƒ½å„ªåŒ–

---

**é–‹ç™¼è€…ï¼š** AI Assistant  
**æœ€å¾Œæ›´æ–°ï¼š** 2026-01-20 23:45
