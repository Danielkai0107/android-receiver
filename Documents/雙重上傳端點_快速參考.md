# 🚀 雙重上傳端點 - 快速參考

## 📡 端點配置

| 類型 | URL | 優先級 |
|------|-----|--------|
| 🥇 主要 | `https://us-central1-safe-net-tw.cloudfunctions.net/receiveBeaconData` | 第一優先 |
| 🥈 備用 | `https://receivebeacondata-kmzfyt3t5a-uc.a.run.app/` | 主要失敗時使用 |

## 🔄 運作流程

```
1. 嘗試主要端點 (Cloud Functions)
   ↓
2. 成功? → ✅ 完成
   ↓
3. 失敗? → 嘗試備用端點 (Cloud Run)
   ↓
4. 成功? → ✅ 完成
   ↓
5. 失敗? → ❌ 記錄錯誤
```

## 📱 快速測試

```bash
# 安裝
adb install app/build/outputs/apk/debug/app-debug.apk

# 或使用測試腳本（推薦）
./test-dual-endpoint.sh
```

## 📊 預期日誌

### ✅ 主要端點成功
```
D  嘗試主要端點 (Cloud Functions)...
D  ✅ 主要端點上傳成功
```

### ⚠️ 主要失敗，備用成功
```
D  嘗試主要端點 (Cloud Functions)...
W  主要端點失敗: [錯誤訊息]
D  嘗試備用端點 (Cloud Run)...
D  ✅ 備用端點上傳成功
```

### ❌ 兩個都失敗
```
D  嘗試主要端點 (Cloud Functions)...
W  主要端點失敗: [錯誤 1]
D  嘗試備用端點 (Cloud Run)...
E  ❌ 所有端點都失敗
E    - 主要端點: [錯誤 1]
E    - 備用端點: [錯誤 2]
```

## 🔍 監控命令

```bash
# 監控上傳日誌
adb logcat | grep -E "UploadRepository|端點"

# 監控完整上傳流程
adb logcat | grep -E "UploadRepository|BeaconScanService.*上傳"
```

## 📂 修改的檔案

1. **新增**: `UploadApi.kt` - API 接口定義
2. **修改**: `NetworkModule.kt` - 雙重 Retrofit 配置
3. **修改**: `UploadRepository.kt` - 重試邏輯實作

## 🎯 測試重點

- [ ] 主要端點優先使用
- [ ] 自動容錯切換
- [ ] 日誌清楚顯示使用的端點
- [ ] 兩個端點都失敗時完整記錄錯誤

## 📄 詳細文檔

查看 `雙重上傳端點實作.md` 了解完整實作細節。
