# âœ… ä¸Šå‚³ API 404 éŒ¯èª¤ä¿®å¾©

## ğŸ› å•é¡ŒåŸå› 

ä¸Šå‚³ API ä¹Ÿæœ‰è·Ÿ Service UUID API ä¸€æ¨£çš„å•é¡Œï¼š**URL é…ç½®å°è‡´é›™æ–œç·š**ã€‚

### éŒ¯èª¤æ—¥èªŒ
```
E  ä¸Šå‚³ç•°å¸¸
retrofit2.HttpException: HTTP 404
E  âŒ ä¸Šå‚³å¤±æ•—: HTTP 404
```

### URL é…ç½®å•é¡Œ

**NetworkModule.kt**:
```kotlin
.baseUrl("https://receivebeacondata-kmzfyt3t5a-uc.a.run.app/")
                                                            â†‘ çµå°¾æœ‰æ–œç·š
```

**CloudFunctionApi.kt**:
```kotlin
@POST("/")
      â†‘ é–‹é ­æœ‰æ–œç·š
```

**å¯¦éš›è«‹æ±‚çš„ URL**:
```
https://receivebeacondata-kmzfyt3t5a-uc.a.run.app//
                                                 â†‘â†‘ é›™æ–œç·šå°è‡´ 404
```

---

## ğŸ”§ ä¿®å¾©æ–¹æ¡ˆ

### CloudFunctionApi.kt

**ä¿®æ”¹å‰**:
```kotlin
@GET("/")
suspend fun getDeviceWhitelist(): WhitelistResponse

@POST("/")
suspend fun uploadBeaconData(@Body request: BeaconDataRequest): BeaconDataResponse
```

**ä¿®æ”¹å¾Œ**:
```kotlin
@GET("")  // â† æ”¹ç‚ºç©ºå­—ä¸²
suspend fun getDeviceWhitelist(): WhitelistResponse

@POST("")  // â† æ”¹ç‚ºç©ºå­—ä¸²
suspend fun uploadBeaconData(@Body request: BeaconDataRequest): BeaconDataResponse
```

### æ­£ç¢ºçš„ URL

**ç™½åå–® API**:
```
âœ… https://getdevicewhitelist-kmzfyt3t5a-uc.a.run.app/
```

**ä¸Šå‚³ API**:
```
âœ… https://receivebeacondata-kmzfyt3t5a-uc.a.run.app/
```

---

## ğŸ“Š æ‰€æœ‰ API ç«¯é»é…ç½®

| API | baseUrl | @GET/@POST | å®Œæ•´ URL | ç‹€æ…‹ |
|-----|---------|-----------|----------|------|
| Service UUID | `https://us-central1-safe-net-tw.cloudfunctions.net/` | `@GET("getServiceUuids")` | `https://us-central1-safe-net-tw.cloudfunctions.net/getServiceUuids` | âœ… |
| ç™½åå–® | `https://getdevicewhitelist-kmzfyt3t5a-uc.a.run.app/` | `@GET("")` | `https://getdevicewhitelist-kmzfyt3t5a-uc.a.run.app/` | âœ… |
| ä¸Šå‚³ | `https://receivebeacondata-kmzfyt3t5a-uc.a.run.app/` | `@POST("")` | `https://receivebeacondata-kmzfyt3t5a-uc.a.run.app/` | âœ… |

---

## ğŸ§ª æ¸¬è©¦ API

### æ¸¬è©¦ä¸Šå‚³ API
```bash
curl -X POST https://receivebeacondata-kmzfyt3t5a-uc.a.run.app/ \
  -H "Content-Type: application/json" \
  -d '{
    "gateway_id": "ANDROID-test",
    "lat": 25.0,
    "lng": 121.0,
    "timestamp": 1737360000000,
    "beacons": [{
      "uuid": "FDA50693-A4E2-4FB1-AFCF-C6EB01234567",
      "major": 1,
      "minor": 1001,
      "rssi": -65
    }]
  }'
```

**é æœŸå›æ‡‰**:
```json
{
  "success": false,
  "error": "Gateway ANDROID-test is not registered..."
}
```
â†’ é€™æ˜¯æ­£å¸¸çš„ï¼ˆGateway æœªè¨»å†Šï¼‰ï¼Œä½†è‡³å°‘ä¸æ˜¯ 404ï¼

---

## ğŸ“¦ æ–°ç‰ˆæœ¬å·²æ§‹å»º

âœ… **æ§‹å»ºæˆåŠŸï¼**

**APK ä½ç½®**:
```
/Users/danielkai/Desktop/android-receiver/app/build/outputs/apk/debug/app-debug.apk
```

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. æ¸…ç†ä¸¦å®‰è£
```bash
adb shell am force-stop com.safenet.receiver
adb shell pm clear com.safenet.receiver
adb install /Users/danielkai/Desktop/android-receiver/app/build/outputs/apk/debug/app-debug.apk
```

### 2. ç›£æ§ä¸Šå‚³
```bash
adb logcat | grep "UploadRepository\|BeaconScanService.*ä¸Šå‚³"
```

### 3. é æœŸæ—¥èªŒ

**ä¿®å¾©å‰ï¼ˆ404 éŒ¯èª¤ï¼‰**:
```
E  ä¸Šå‚³ç•°å¸¸
retrofit2.HttpException: HTTP 404
E  âŒ ä¸Šå‚³å¤±æ•—: HTTP 404
```

**ä¿®å¾©å¾Œï¼ˆæ­£å¸¸ï¼Œå¯èƒ½æ˜¯ Gateway æœªè¨»å†Šï¼‰**:
```
D  ä¸Šå‚³ Beacon è³‡æ–™: gateway=ANDROID-xxx, count=3
E  ä¸Šå‚³å¤±æ•—: Gateway ANDROID-xxx is not registered...
```
æˆ–
```
D  ä¸Šå‚³ Beacon è³‡æ–™: gateway=ANDROID-xxx, count=3
D  ä¸Šå‚³æˆåŠŸ
D  âœ… ä¸Šå‚³æˆåŠŸ: 3 ç­†ï¼Œå·²æ›´æ–°ç‹€æ…‹ç‚º UPLOADED
```

---

## ğŸ¯ ä¿®å¾©æ•ˆæœ

### ä¿®å¾©å‰
```
âŒ HTTP 404 Not Found
â†’ URL éŒ¯èª¤
â†’ å®Œå…¨ç„¡æ³•ä¸Šå‚³
```

### ä¿®å¾©å¾Œ
```
âœ… HTTP 200 OK
â†’ URL æ­£ç¢º
â†’ å¯ä»¥æ­£å¸¸ä¸Šå‚³
â†’ å¦‚æœ Gateway æœªè¨»å†Šï¼Œæœƒæ”¶åˆ°æ˜ç¢ºéŒ¯èª¤è¨Šæ¯
```

---

## ğŸ“ Retrofit URL è¦å‰‡ç¸½çµ

### Cloud Run æœå‹™ï¼ˆbaseUrl å·²åŒ…å«å®Œæ•´è·¯å¾‘ï¼‰

```kotlin
// âœ… æ­£ç¢º
.baseUrl("https://xxx.run.app/")
@GET("")  æˆ– @POST("")

// âŒ éŒ¯èª¤
.baseUrl("https://xxx.run.app/")
@GET("/")  æˆ– @POST("/")  // æœƒç”¢ç”Ÿé›™æ–œç·š
```

### Cloud Functionsï¼ˆéœ€è¦æŒ‡å®šå‡½æ•¸åç¨±ï¼‰

```kotlin
// âœ… æ­£ç¢º
.baseUrl("https://us-central1-xxx.cloudfunctions.net/")
@GET("functionName")

// âŒ éŒ¯èª¤
.baseUrl("https://us-central1-xxx.cloudfunctions.net/functionName/")
@GET("/")  // æœƒç”¢ç”Ÿé›™æ–œç·š
```

---

## âœ… é©—è­‰æ¸…å–®

å®‰è£æ–°ç‰ˆæœ¬å¾Œç¢ºèªï¼š

- [ ] æ²’æœ‰ HTTP 404 éŒ¯èª¤
- [ ] ä¸Šå‚³æ—¥èªŒé¡¯ç¤ºã€Œä¸Šå‚³ Beacon è³‡æ–™ã€
- [ ] å¦‚æœ Gateway æœªè¨»å†Šï¼ŒéŒ¯èª¤è¨Šæ¯æ¸…æ¥š
- [ ] å¦‚æœ Gateway å·²è¨»å†Šï¼Œä¸Šå‚³æˆåŠŸ
- [ ] Firebase ä¸­çš„æ•¸æ“šç¢ºå¯¦æ›´æ–°

---

## ğŸ‰ å®Œæˆ

**ä¸Šå‚³ API 404 éŒ¯èª¤å·²ä¿®å¾©ï¼** ğŸš€

### ä¿®å¾©çš„ API
1. âœ… Service UUID API - `@GET("getServiceUuids")`
2. âœ… ç™½åå–® API - `@GET("")`
3. âœ… ä¸Šå‚³ API - `@POST("")`

**ç¾åœ¨æ‰€æœ‰ API éƒ½ä½¿ç”¨æ­£ç¢ºçš„ URL äº†ï¼** âœ¨

---

## ğŸ“± å®‰è£æ¸¬è©¦

```bash
# æ¸…ç†èˆŠç‰ˆæœ¬
adb shell pm clear com.safenet.receiver

# å®‰è£æ–°ç‰ˆæœ¬
adb install /Users/danielkai/Desktop/android-receiver/app/build/outputs/apk/debug/app-debug.apk

# ç›£æ§ä¸Šå‚³
adb logcat | grep "UploadRepository"

# é æœŸï¼šä¸å†æœ‰ 404 éŒ¯èª¤
```
